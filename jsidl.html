<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html lang=en><head>

<meta content="text/html; charset=utf-8" http-equiv=content-type>
<title>JSIDL</title>
<link href=http://dev.w3.org/2006/webapi/WebIDL/WebIDL.css rel=stylesheet type=text/css>
<link href=http://www.w3.org/StyleSheets/TR/W3C-ED rel=stylesheet type=text/css>

<script src=http://dev.w3.org/2006/webapi/WebIDL/section-links.js type=application/ecmascript></script>
<script src=http://dev.w3.org/2006/webapi/WebIDL/dfn.js type=application/ecmascript></script>

</head>

<body class=draft>

<div class=head>
	<h1>JSIDL</h1>
	
	<h2 class="no-num no-toc" id=working-draft-10-april-2013>Working Draft â€” 10 April 2013</h2>
	
	<dl>
		<dt>This version:
		</dt><dd><!--begin-link--><a href=http://wycats.github.io/jsidl/jsidl.html>http://wycats.github.io/jsidl/jsidl.html</a><!--end-link-->
		
		</dd><dt>Editors:
		</dt><dd class=vcard>
			<span class=fn>Yehuda Katz</span>,
			<span class=org>jQuery Foundation</span>,
			<span class=email>wycats@gmail.com</span>
	</dd></dl>
	
  <p>
    <a href=http://creativecommons.org/publicdomain/zero/1.0/ rel=license>
       <img alt=CC0 src=http://i.creativecommons.org/p/zero/1.0/88x31.png style="border-style: none;">
    </a>
    <br>
    To the extent possible under law,
    <a href=http://wycats.github.io/jsidl/jsidl.html rel=dct:publisher>
      <span>Yehuda Katz</span></a>
    has waived all copyright and related or neighboring rights to
    <span>JSIDL</span>.
  </p>
</div>

<h2 class="no-num no-toc" id=abstract>Abstract</h2>

<p>This document is an attempt to define an ECMAScript focused IDL for use
by web specifications.</p>
<p>It is a work in progress and is still missing a significant amount of
semantics provided by the current WebIDL specification.</p>

<h2 class="no-num no-toc" id=status>Status</h2>

<p>This is a <strong>work in progress</strong>.</p>

<p>Among many other things, it still needs a formal description of the syntax
of JSIDL, a description of the programming environment, and a description and
specification of a branding mechanism.</p>

<p>This document is not yet ready for wide feedback and is being circulated
to get the work I'm doing on this topic into the open. It is still at an
extremely early stage.</p>

<h2 class="no-num no-toc" id=table-of-contents>Table of Contents</h2>


<!--begin-toc-->
<ol class=toc>
 <li><a href=#types-0><span class=secno>1 </span>Types</a></li>
 <li><a href=#type-tests><span class=secno>2 </span>Type Tests</a>
  <ol>
   <li><a href=#object><span class=secno>2.1 </span>object</a></li>
   <li><a href=#class-or-interface><span class=secno>2.2 </span>class or interface</a></li>
   <li><a href=#options><span class=secno>2.3 </span>options</a></li>
   <li><a href=#enum><span class=secno>2.4 </span>enum</a></li></ol></li>
 <li><a href=#type-coercions><span class=secno>3 </span>Type Coercions</a>
  <ol>
   <li><a href=#any><span class=secno>3.1 </span>any</a></li>
   <li><a href=#toboolean><span class=secno>3.2 </span>ToBoolean</a></li>
   <li><a href=#tointeger><span class=secno>3.3 </span>ToInteger</a></li>
   <li><a href=#topositiveinteger><span class=secno>3.4 </span>ToPositiveInteger</a></li>
   <li><a href=#tonumber><span class=secno>3.5 </span>ToNumber</a></li>
   <li><a href=#tostring><span class=secno>3.6 </span>ToString</a></li>
   <li><a href=#toobject><span class=secno>3.7 </span>ToObject</a></li>
   <li><a href=#class-or-interface-0><span class=secno>3.8 </span>class or interface</a></li>
   <li><a href=#options-0><span class=secno>3.9 </span>options</a></li>
   <li><a href=#enum-0><span class=secno>3.10 </span>enum</a></li></ol></li>
 <li><a href=#function-arguments><span class=secno>4 </span>Function Arguments</a>
  <ol>
   <li><a href=#default-arguments><span class=secno>4.1 </span>Default Arguments</a></li></ol></li>
 <li><a class=no-num href=#acknowledgements>Acknowledgements</a></li></ol>
<!--end-toc-->

<div id=sections>

<div class=section id=types>
<h2 id=types-0><span class=secno>1 </span>Types</h2>

<p>A <dfn id=type>type</dfn> in JSIDL represents two things.</p>

<ul>
  <li>A test to apply against an ECMAScript value to determine whether it is
  already a member of the type.</li>
  <li>A coercion rule to apply against any ECMAScript value that passes the
  test.</li>
</ul>

<p>The rules apply to:</p>

<ul>
  <li>an argument into a function with the specified type <var>T</var></li>
  <li>a values to setters with the specified type <var>T</var></li>
</ul>

<p>In either of the above situations, when the user supplies a value <var>V</var>,
perform the following steps:</p>

<ol>
  <li>If performing <var>T</var>'s type test with <var>V</var> returns false,
  throw a <code>TypeError</code>.</li>
  <li>Let <var>C</var> be the result of performing <var>T</var>'s coercion with
  <var>V</var>.</li>
  <li>Continue as if the user supplied <var>C</var>.</li>
</ol>

</div>

<div class=section id=tests>
<h2 id=type-tests><span class=secno>2 </span>Type Tests</h2>

<p>By default, a type's test passes for all ECMAScript values. This is because
many types in JSIDL represent coercions that will always succeed. Exceptions are
presented as subsections of this section.</p>

<h3 id=object><span class=secno>2.1 </span>object</h3>

<p>If a value <var>V</var> is an ECMAScript value other than <code>null</code>
or <code>undefined</code>, return <code>true</code>.</p>

<h3 id=class-or-interface><span class=secno>2.2 </span>class or interface</h3>

<p>Each platform-defined class or interface installs a non-forgable Brand
on each object using its
<a class=external href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-15.3.4.6>@@create</a>
method.</p>

<p>A value <var>V</var> passes the test for a class or interface type with the
brand <var>B</var> if the following algorithm returns <code>true</code>.</p>

<ol>
  <li>If <a class="external dfnref" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-8>Type</a>(<var>V</var>) is not
  <var>Object</var>, return false.</li>
  <li>If <var>V</var> has the brand <var>B</var>, return true.</li>
  <li>Return false</li>
</ol>

<h3 id=options><span class=secno>2.3 </span>options</h3>

<p>An options type is an <a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-11.13.1>ObjectBindingPattern</a>
with type annotations.</p>

<div class=note><div class=noteHeader>Note</div>
  <p>This algorithm boils down to:</p>
  <ol>
    <li>Checking whether ECMAScript would throw if attempting to perform the
    destructuring assignment represented by the options pattern.</li>
    <li>Recursively running the type checks for the specified types.</li>
  </ol>
</div>

<p>A value <var>V</var> passes the test for an options type if the following
algorithm returns <code>true</code>.</p>

<div class=note><div class=noteHeader>TODO</div>
  <p>Find the cleanest way to reuse the logic in the ES6 spec here and below
  in the coercion logic.</p>
</div>

<ol>
  <li>Apply <a class="external dfnref" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-11.13.1>Destructuring Assignment Evaluation</a>
  for the options type using <var>V</var> as the argument. If the algorithm throws an exception, return false.</li>
  <li>For each property <var>P</var> with type <var>T</var> in the options type:
    <ol>
      <li>Let <var>X</var> be the result of applying <a class="external dfnref" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-8.3.9>[[Get]]</a>
      with the arguments <var>P</var> and <var>V</var>.</li>
      <li>If the result of applying <var>T</var>'s test on <var>X</var> is <code>false</code>, return <code>false</code>.</li>
    </ol>
  </li>
  <li>Return <code>true</code>.</li>
</ol>

<h3 id=enum><span class=secno>2.4 </span>enum</h3>

<p>An enum is a set of strings <var>E</var>.</p>
<p>An ECMAScript value <var>V</var> passes the type test if the following
algorithm returns true.</p>

<ol>
  <li>Let <var>S</var> be the result of calling
  <a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.8>ToString</a>(<var>V</var>).</li>
  <li>If <var>S</var> is not in <var>E</var>, return <code>false</code>.</li>
  <li>return <code>true</code>.</li>
</ol>


</div>

<div class=section id=coercions>
<h2 id=type-coercions><span class=secno>3 </span>Type Coercions</h2>

<p>This section describes how to coerce values when:

</p><ul>
  <li>they are passed as arguments into a function with a specified type
  </li><li>they are passed as values to setters with a specified type
</li></ul>

<p>Each sub-section below describes how to coerce a value into the
specified type</p>

<h3 id=any><span class=secno>3.1 </span>any</h3>

<p>No coercion is performed.</p>

<h3 id=toboolean><span class=secno>3.2 </span>ToBoolean</h3>

<p>A value <var>V</var> is coerced to a <var>ToBoolean</var> value using the ECMAScript
<a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.2>ToBoolean</a>
abstract operation.</p>

<h3 id=tointeger><span class=secno>3.3 </span>ToInteger</h3>

<p>A value <var>V</var> is coerced to a <var>ToInteger</var> value using the ECMAScript
<a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.4>ToInteger</a>
abstract operation.</p>

<h3 id=topositiveinteger><span class=secno>3.4 </span>ToPositiveInteger</h3>

<p>A value <var>V</var> is coerced to a <var>ToPositiveInteger</var> value using the ECMAScript
<a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.11>ToPositiveInteger</a>
abstract operation.</p>

<h3 id=tonumber><span class=secno>3.5 </span>ToNumber</h3>

<p>A value <var>V</var> is coerced to a <var>ToNumber</var> value using the ECMAScript
<a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.3>ToNumber</a>
abstract operation.</p>

<h3 id=tostring><span class=secno>3.6 </span>ToString</h3>

<p>A value <var>V</var> is coerced to a <var>ToString</var> value using the ECMAScript
<a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.8>ToString</a>
abstract operation.</p>

<h3 id=toobject><span class=secno>3.7 </span>ToObject</h3>

<p>A value <var>V</var> is coerced to a <var>ToObject</var> value using the ECMAScript
<a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.9>ToObject</a>
abstract operation.</p>

<div class=note><div class=noteHeader>Note</div>
  <p>WebIDL requires that the value <var>V</var> return <span class=esvalue>Object</span>
  for <a class=external href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-8>Type(<var>V</var>)</a>.</p>
  <p>However, this coercion is not uniformly implemented, and coercing primitives to
  objects in this situation is more consistent with similar built-in ECMAScript operations.</p>
</div>

<h3 id=class-or-interface-0><span class=secno>3.8 </span>class or interface</h3>

<p>No coercion is performed.</p>

<div class=note><div class=noteHeader>Note</div>
  <p>Any value that gets through the type test for a particular class or interface is
  already an instance of that class or interface.</p>
</div>


<h3 id=options-0><span class=secno>3.9 </span>options</h3>

<p>A value <var>V</var> is coerced into a particular options type as if by applying the
ECMAScript destructuring assignment algorithm with the following modification:</p>

<div class=note>
  <p>Before Step 7 of the Keyed Destructuring Assignment Evaluation algorithm, coerce
  <var>v</var> into the specified type using the coercion rules defined here.</p>
</div>

<h3 id=enum-0><span class=secno>3.10 </span>enum</h3>

<p>An enum is a Set of String values.</p>

<p>A value <var>V</var> is coerced into an enum <var>E</var> as follows.</p>

<ol>
  <li>Let <var>S</var> be the result of calling
  <a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-9.1.8>ToString</a>(<var>V</var>).</li>
  <li>If <var>S</var> is not in <var>E</var>, throw a <var>RangeError</var>.</li>
  <li>return <var>S</var>.</li>
</ol>
</div>

<div class=section id=function-args>
<h2 id=function-arguments><span class=secno>4 </span>Function Arguments</h2>

<p>Function parameters are specified in JSIDL as a type-annotated <a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-13.1>FormalParameterList</a>.</p>
<p>If a parameter is specified without a default, it is a <var>TypeError</var> to
call the function without specifying that parameter.</p>

<h3 id=default-arguments><span class=secno>4.1 </span>Default Arguments</h3>

<p>Default arguments are specified as in ECMAScript, by following the parameter's name with an <a class="dfnref external" href=http://people.mozilla.org/~jorendorff/es6-draft.html#sec-11.1.5>Initialiser.</a></p>
<p>As a shortcut, <code>=undefined</code> may be replaced with <code>?</code>.

</p><div class=example><div class=exampleHeader>Example</div>
  <div class=block><div class=blockTitleDiv><span class=blockTitle>IDL</span></div><div class=blockContent><pre class=code><code class=idl-code>
class ColorCreator {
  object createColor(number v1, number v2, number v3, number alpha?);
}
  </code></pre></div></div>

  <p>In this example, <code>createColor</code> must be called with three or four arguments. If the
  fourth argument is omitted, its value will be undefined.</p>
</div>
</div>

</div>

<div id=appendices>
</div>

<h2 class=no-num id=acknowledgements>Acknowledgements</h2>

</body></html>